<!DOCTYPE html>
<html>
  <head>
    <title>RippleWeave</title>
    <meta utf='8'/>
    <meta name='author'       content='Xing Liu'/>
    <meta name='description'  content='cos(x²)+sin(y²) is a pretty neat graph'/>
    <meta name='keywords'     content='graph,math,wallpaper'/>
    <link rel='shortcut icon' type='image/png' href='fav.png'/>
    <style>
html,body{
  margin:0;
}
 
body{
  background-image:linear-gradient(90deg,#fff8,#fff8 50%,#0008 50%,#0008),
                   linear-gradient(#fff,#fff 50%,#000 50%,#000);
  background-size:4rem 4rem;
}
      
*{
  box-sizing:border-box;
}
      
canvas{
  position:fixed;
  top:0;
  right:0;
  width:100vmin;
  height:100vmin;
  background:#fff;
  image-rendering:pixelated
}
      
main{
  position:fixed;
  overflow:scroll;
  display:block;
  left:0;
  width:calc(100vw - 100vmin);
  height:100vh;
  min-width:20rem;
  background:#111;
  font-family:Monospace,Monospace;
  color:#fff;
  padding:1rem 1rem 0 .6rem;
  text-align:center;
  text-align-last:center;
}

main>section{
  display:flex;
  flex-wrap:wrap;
}

section>section{
  flex:1 1 10rem;
  min-width:10rem;
  margin:.2rem;
}
      
::selection{
  background:#888;
  color:#fff;
}

:focus{
  outline:none;
}

.download{
  text-decoration:none;
}
      
section>section>*{
  display:flex;
  align-items:center;
  justify-content:center;
  
  padding:.2rem;
  font-size:inherit;
  font-family:inherit;
  color:inherit;
  width:100%;
  height:2rem;
  margin:.2rem;
  border-width:.2rem;
  border-style:solid;
}

h2{
	font-size:1rem;
	font-weight:normal;
	flex-basis:100%;
	margin:0.2rem;
  padding:.2rem;
  color:#888;
	border:solid .2rem #222;
}
label{
  background:#222;
  border-color:#000;
}
input,select,.download{
  background:#000;
  border-color:#222;
}
select,.download{
  cursor:pointer;
}
      
input[type=range]{
  -webkit-appearance:none;
  flex:1 0 12rem;
  background:#000;
  cursor:ew-resize;
  background-size:calc(100% - .5rem) calc(100% - .5rem);
  background-position:center;
  background-repeat:no-repeat;
}
input:hover:not(:focus),.download:hover:not(:focus){
  background:#111;
  border-color:#333
}
input:focus,.download:focus{
  border-color:#444
}
input:focus:hover,.download:focus:hover{
  border-color:#555
}
      
input[name=hue-offset][type=range]{
  --sat:100%;
  --lum:10%;
  background-image:linear-gradient(
    90deg,
    hsl(0deg,var(--sat),var(--lum)),
    hsl(120deg,var(--sat),var(--lum)),
    hsl(240deg,var(--sat),var(--lum)),
    hsl(360deg,var(--sat),var(--lum))
  );
}
input[name=sat-offset][type=range]{
  background-image:linear-gradient(
    90deg,
    hsl(0deg,0%,10%),
    hsl(120deg,33.3%,12%),
    hsl(240deg,66.7%,14%),
    hsl(360deg,100%,16%)
  );
}
input[name=lum-offset][type=range],input[name=alpha-offset][type=range]{
  background-image:linear-gradient(90deg,#000,#222);
}

            
@media(prefers-color-scheme:light){
  main{
    filter:invert(1)
  }
  input[name=lum-offset][type=range],input[name=alpha-offset][type=range]{
    background-image:linear-gradient(90deg,#222,#000);
  }
}

#custom-function{
	visibility:collapsed;
}
    </style>
  </head>
  <body>
    <canvas></canvas>
    <main>
      
      <h1>RippleWeave</h1>
      
      <section>
	      <h2>A function grapher by Xing</h2>
      	<section>
	      	<label>Function</label>
          <select name='f'>
            <option value='|sin(x^2)+cos(y^2)|/2'>|sin(x^2)+cos(y^2)|/2</option>
            <option value='|sin(x^2)+cos(y^2)|/2'>|sin(x^2)-cos(y^2)|/2</option>
            <option value='|tan(x/y)*(y-sin(x))+cos(x/y)|*x'>|tan(x/y)*(y-sin(x))+cos(x/y)|*x</option>
            <option value='|tan(x/y)*(y-sin(y*x))+cos(x/y)|*x'>|tan(x/y)*(y-sin(y*x))+cos(x/y)|*x</option>
            <option value='|cos(x/y)-tan(x/y)*(y-sin(y*x))|*x'>|cos(x/y)-tan(x/y)*(y-sin(y*x))|*x</option>
            <option value='custom'>custom</option>
          </select>
	        <input id='custom-function' name='f' type='text' value='|sin(x^2)+cos(y^2)|/2'/>
         </section>
    	</section>

      <section>
      	<h2>Render</h2>
        <section>
          <label>Download</label>
          <a class='download image' id='png' download='ripple-weave.png' href='#'>PNG</a>
          <a class='download image' id='jpg' download='ripple-weave.jpg' href='#'>JPG</a>
        </section>
        <section>
          <label>Background</label>
          <select name='background-opt'>
            <option value='white'>white</option>
            <option value='grey'>grey</option>
            <option value='black'>black</option>
            <option value='transparent'>transparent</option>
          </select>
        </section>
        <section>
          <label>Resolution</label>
          <select name='resolution-opt'>
            <option value='pixelated'>pixelated</option>
            <option value='auto'>smooth</option>
          </select>
          <input name='resolution' type='number' value='32'/>
          <input name='resolution' type='range'  value='32' min='1' max='1024'/>
        </section>
        <section>
          <label>Zoom</label>
          <input name='zoom' type='number' value='-10'/>
          <input name='zoom' type='range'  value='-10' min='-256' max='0' step='.1'/>
        </section>
      </section>
      <section>
      	<h2>Channels</h2>
        <section>
          <label>Hue</label>
          <select name='hue-opt'>
            <option value='0'>0</option>
            <option value='1'>f(x,y)</option>
            <option value='2' selected>f(y,x)</option>
            <option value='3'>1-f(x,y)</option>
            <option value='4'>1-f(y,x)</option>
          </select>
          <input name='hue-offset' type='number' value='0'/>
          <input name='hue-offset' type='range'  value='0' min='0' max='360'/>
        </section>
        <section>
          <label>Saturation</label>
          <select name='sat-opt'>
            <option value='0' selected>0</option>
            <option value='1'>f(x,y)</option>
            <option value='2'>f(y,x)</option>
            <option value='3'>1-f(x,y)</option>
            <option value='4'>1-f(y,x)</option>
          </select>
          <input name='sat-offset' title='offset' type='number' value='100'/>
          <input name='sat-offset' title='offset' type='range'  value='100' min='0' max='100'/>
        </section>
        <section>
          <label>Luminosity</label>
          <select name='lum-opt'>
            <option value='0'>0</option>
            <option value='1' selected>f(x,y)</option>
            <option value='2'>f(y,x)</option>
            <option value='3'>1-f(x,y)</option>
            <option value='4'>1-f(y,x)</option>
          </select>
          <input name='lum-offset' title='offset' type='number' value='0'/>
          <input name='lum-offset' title='offset' type='range'  value='0' min='0' max='100'/>
        </section>
        <section>
          <label>Alpha</label>
          <select name='alpha-opt' title='base function'>
            <option value='0' selected>0</option>
            <option value='1'>f(x,y)</option>
            <option value='2'>f(y,x)</option>
            <option value='3'>1-f(x,y)</option>
            <option value='4'>1-f(y,x)</option>
          </select>
          <input name='alpha-offset' title='offset' type='number' value='100'/>
          <input name='alpha-offset' title='offset' type='range'  value='100' min='0' max='100'/>
        </section>
      </section>
      <section>
      	<h2>Transform</h2>
        <section>
          <label>Translate X</label>
          <input name='x-offset' type='range'  value='0' min='-128' max='128' orient='vertical'/>
          <input name='x-offset' type='number' value='0'/>
        </section>
        <section>
          <label>Translate Y</label>
          <input name='y-offset' type='range'  value='0' min='-128' max='128' orient='vertical'/>
          <input name='y-offset' type='number' value='0'/>
        </section>
      </section>
    </main>
  <script>
let size      = 32 ,
    zoom      = -10 ,
    f					= 'Math.abs(Math.sin(x**2)+Math.cos(y**2))/2',
    xOffset   = -64 ,
    yOffset   = -64 ,
    hueOpt    = 2,
    hueOffset = 0,
    satOpt    = 0,
    satOffset = 100,
    lumOpt    = 1,
    lumOffset = 0,
    alphaOpt  = 0,
    alphaOffset = 100
const doc     = document ,
      canvas  = doc.getElementsByTagName('canvas')[0] ,
      ctx     = canvas.getContext('2d') ,
      inputs    = Array.from(doc.querySelectorAll('input,select')) ,
      downloads = Array.from(doc.getElementsByClassName('download')) ,
      norm360 = ( value ) => {
        return Math.abs ( value % 360 )
      },
      norm100 = ( value ) => {
        return Math.min ( ( Math.max ( value , 0 ) ) , 100 )
      },
      handler = ( event ) => {
        let name  = event.target.name,
            value = event.target.value,
            tag   = event.target.tagName
        if ( value ) {
          switch ( name ) {
            case 'resolution':
              size = value = Math.max ( value , 1 )
              break
            case 'resolution-opt':
              canvas.style.imageRendering = value
              break
            case 'background-opt':
              canvas.style.background = value
              break
            case 'hue-opt':
              hueOpt = value
              break
            case 'sat-opt':
              satOpt = value
              break
            case 'lum-opt':
              lumOpt = value
              break
            case 'alpha-opt':
              alphaOpt = value
              break
            case 'zoom':
              zoom = value = - Math.abs(value)
              break
            case 'x-offset':
              xOffset = value - size/2
              break
            case 'y-offset':
              yOffset = value - size/2
              break
            case 'hue-offset':
              hueOffset = value = norm360 ( value )
              break
            case 'sat-offset':
              satOffset = value = norm100 ( value )
              break
            case 'lum-offset':
              lumOffset = value = norm100 ( value )
              break
            case 'alpha-offset':
              alphaOffset = value = norm100 ( value )
              break
            case 'f':
            	if ( value === 'custom' || tag === 'INPUT' ) {
            		doc.getElementById('custom-function').style.visibility='visible'
            	} else {
            		doc.getElementById('custom-function').style.visibility='collapsed'
            	}
              f = value.replace(/(sin|cos|tan)/g,'Math.$1').replace(/\^/g,'**').replace(/\|/,'Math.abs(').replace(/\|/,')')
              break
          }
          if ( name!=='f' && ( tag === 'SELECT' || tag === 'INPUT' ) ) {
            Array.from(
              doc.getElementsByName( name )
            ).forEach( ( input ) => {
              input.value = value
            })
          }
        }
      } ,
      graph   = ( x , y ) => {
        ctx.fillRect( x , y , 1 , 1 )
      } ,
      funct   = ( x , y ) => {
      	x = ( x + xOffset*size/128 ) / ( size / -zoom )
      	y = ( y + yOffset*size/128 ) / ( size / -zoom )
      	return eval ( f )
      } ,
      draw = () => {
        canvas.width  = size
        canvas.height = size
        for ( let y = 0 ; y < size ; y ++ ) {
          for ( let x = 0 ; x < size ; x ++ ) {
            let opt = [ 0,
                        funct ( x , y ),
                        funct ( y , x ),
                      ]
            opt[3] = 1 - opt[1]
            opt[4] = 1 - opt[2]
            ctx.fillStyle = `
              hsla(
                ${ opt[hueOpt]*360 + hueOffset },
                ${ opt[satOpt]*100 + satOffset }%,
                ${ opt[lumOpt]*100 + lumOffset }%,
                ${ opt[alphaOpt] + alphaOffset/100 }
              )
            `
            graph ( x , y )
          }
        }
      }
inputs.forEach((element)=>{
  element.addEventListener('input',handler)
  element.addEventListener('change',draw)
})
downloads.forEach((element)=>{
  element.addEventListener('click',()=>{
    element.href = canvas.toDataURL(`img/${element.id}`).replace(/^data:image\/[^;]*/, 'data:application/octet-stream')
  } , false)
})
draw()
    </script>
  </body>
</html>